
# Windows 系统敏感信息彻底清除指南

**涵盖文件删除与内容覆盖，确保历史记录无残留**

## 一、准备工作（操作前必做）

**batch**

复制

下载

```
:: 1. 安装必要工具
pip install git-filter-repo  &REM 安装历史重写工具

:: 2. 创建完整仓库备份（操作不可逆）
xcopy /E /I /Y "D:\project" "D:\project_backup" &REM 创建完整项目备份
git branch backup-before-cleanup &REM 创建Git分支备份

:: 3. 进入项目目录
cd /d D:\path\to\your\project
```

## 二、敏感文件彻底删除流程

### 场景：需要完全移除包含敏感信息的文件（如密钥文件）

**batch**

复制

下载

```
:: 1. 删除文件及其所有历史记录
git filter-repo ^
  --path "src/config/credentials.key" ^  &REM 指定要删除的文件路径
  --path "database/secrets.env" ^       &REM 可指定多个文件
  --invert-paths ^                     &REM 反转选择（删除匹配文件）
  --force                              &REM 强制操作

:: 2. 特殊文件名处理（含空格/括号）
git filter-repo ^
  --path-regex "static/AccessKey \(1\)\.csv" ^  &REM 使用正则处理特殊字符
  --invert-paths
```

## 三、敏感内容覆盖流程

### 场景：保留文件但清除文件中的敏感内容（如配置文件中的密码）

**batch**

复制

下载

```
:: 1. 创建替换规则文件 replace-rules.txt
(
  echo regex:password=\w+==>password=***REDACTED***
  echo regex:api_key="[^"]+"==>api_key="***REDACTED***"
  echo regex:AKIA[0-9A-Z]{16}==>***AWS_KEY_REDACTED***
) > replace-rules.txt

:: 2. 执行内容替换
git filter-repo ^
  --replace-text replace-rules.txt ^  &REM 应用替换规则
  --force                            &REM 强制操作

:: 3. 高级内容替换（Python回调）
git filter-repo ^
  --blob-callback "
    if b'config.ini' in blob.path:
        # 替换数据库密码
        content = blob.data.decode('utf-8').replace('password=secret123', 'password=***REDACTED***')
        blob.data = content.encode('utf-8')
  " ^
  --force
```

## 四、强制推送到远程仓库

**batch**

复制

下载

```
:: 1. 检查远程配置
git remote -v

:: 2. 更新远程URL（如果需要）
git remote set-url origin https://github.com/yourname/repo.git

:: 3. 强制推送所有内容
git push origin --force --all           &REM 强制推送所有分支
git push origin --force --tags          &REM 强制推送所有标签
git push origin --force "refs/replace/*" &REM 强制推送替换引用

:: 4. 清除GitHub缓存（加速更新）
git commit --allow-empty -m "Clear GitHub cache"
git push origin HEAD
```

## 五、本地仓库深度清理

**batch**

复制

下载

```
:: 1. 删除备份引用
git for-each-ref --format="delete %(refname)" refs/original | git update-ref --stdin

:: 2. 清除所有reflog
git reflog expire --expire=now --all

:: 3. 垃圾回收释放空间
git gc --prune=now --aggressive

:: 4. 删除本地敏感文件（若存在）
del /f /q "src\config\credentials.key"
```

## 六、全面验证效果

**batch**

复制

下载

```
:: 1. 检查文件是否存在历史记录中
git log --all --name-only | findstr /I "credentials.key secrets.env"

:: 2. 检查敏感内容是否被清除
git log -S "secret123" --all               &REM 搜索特定字符串
git log -S "AKIA" --all                    &REM 搜索AWS密钥模式

:: 3. 检查特定文件历史内容
git show HEAD~3:src/config.ini | findstr "password="

:: 4. GitHub在线检查
start https://github.com/yourname/repo/blob/main/src/config.ini
```
